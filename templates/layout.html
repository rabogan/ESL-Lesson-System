<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>B-Grade English</title>
        <link href="/static/favicon.ico" rel="icon">
        <link rel="stylesheet" href="{{url_for('static',filename='dist/css/output.css')}}">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
        <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.10.2/main.min.css' rel='stylesheet' />
        <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.10.2/main.min.js'></script>
        <link rel="stylesheet" href="https://unpkg.com/flowbite@1.4.6/dist/flowbite.min.css" />
        <script src="https://unpkg.com/flowbite@1.4.6/dist/flowbite.js"></script>
    </head>

    <body class="bg-white dark:bg-gray-900">
        <div class="flex flex-col min-h-screen">
            <nav class="bg-white border-gray-200 dark:bg-gray-800">
                <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
                    <button id="theme-toggle" class="hidden md:inline-flex text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg text-sm p-2.5">
                        <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 2a8 8 0 100 16 8 8 0 000-16zM10 0a10 10 0 110 20A10 10 0 0110 0z"></path>
                        </svg>
                        <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 4a6 6 0 110 12A6 6 0 0110 4z"></path>
                        </svg>
                        <span id="theme-toggle-text" class="ml-2">Dark Mode</span>
                    </button>
                    <a href="/" class="flex items-center space-x-3 rtl:space-x-reverse">
                        <img src="/static/img/logo.png" class="h-8" alt="Logo" />
                        <span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">B-Grade English</span>
                    </a>
                    <div class="flex items-center md:order-2 space-x-3 md:space-x-0 rtl:space-x-reverse">
                        {% if current_user.is_authenticated %}
                        <!-- User is authenticated, show user menu -->
                        <button type="button" class="flex text-sm bg-gray-800 rounded-full md:me-0 focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600" id="user-menu-button" aria-expanded="false" data-dropdown-toggle="user-dropdown" data-dropdown-placement="bottom">
                            <span class="sr-only">Open user menu</span>
                            {% if session['user_type'] == 'teacher' %}
                                <img class="w-8 h-8 rounded-full" src="{{ url_for('static', filename='img/teacherImg/' + (current_user.profile.image_file if current_user.profile else 'default.jpg')) }}" alt="user photo">
                            {% elif session['user_type'] == 'student' %}
                                <img class="w-8 h-8 rounded-full" src="{{ url_for('static', filename='img/studentImg/' + (current_user.profile.image_file if current_user.profile else 'default1.jpg')) }}" alt="user photo">
                            {% endif %}
                        </button>
                        <!-- Dropdown menu -->
                        <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700 dark:divide-gray-600" id="user-dropdown">
                            <div class="px-4 py-3">
                                <span class="block text-sm text-gray-800 dark:text-white">{{ current_user.username }}</span>
                                <span class="block text-sm  text-gray-500 truncate dark:text-gray-400">{{ current_user.email }}</span>
                            </div>
                            <ul class="py-2" aria-labelledby="user-menu-button">
                                {% if session['user_type'] == 'teacher' %}
                                <li>
                                    <a href="{{ url_for('teacher_dashboard') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Teacher Dashboard</a>
                                </li>
                                <li>
                                    <a href="{{ url_for('edit_teacher_profile') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Edit Profile</a>
                                </li>
                                <li>
                                    <a href="{{ url_for('manage_lesson_slots') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Schedule Management</a>
                                </li>
                                {% elif session['user_type'] == 'student' %}
                                <li>
                                    <a href="{{ url_for('student_dashboard') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Student Dashboard</a>
                                </li>
                                <li>
                                    <a href="{{ url_for('edit_student_profile') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Edit Profile</a>
                                </li>
                                <li>
                                    <a href="{{ url_for('student_book_lesson') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Lesson Booking</a>
                                </li>
                                {% endif %}
                                <li>
                                    <a href="{{ url_for('logout') }}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Sign out</a>
                                </li>
                            </ul>
                        </div>
                        <!-- Hamburger menu button -->
                        <button class="md:hidden flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" id="navbar-toggle">
                            <span class="sr-only">Open main menu</span>
                            <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15" />
                            </svg>
                        </button>
                        {% else %}
                        <!-- User is not authenticated, show Login/Register button -->
                        <div class="flex items-center justify-end md:order-3">
                            <a href="/portal_choice" class="block py-2 px-3 text-white bg-blue-700 rounded">Login/Register</a>
                        </div>
                        {% endif %}
                    </div>
                    <div class="hidden md:flex items-center justify-between w-full md:w-auto md:order-1" id="navbar-links">
                        <ul class="flex flex-col font-medium p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-800 dark:border-gray-700">
                            <li>
                                <a href="/" class="block py-2 px-3 text-white bg-blue-700 rounded md:bg-transparent md:text-blue-700 md:p-0 md:dark:text-blue-500" aria-current="page">Home</a>
                            </li>
                            <li>
                                <a href="/meetYourTeacher" class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Teacher</a>
                            </li>
                            <li>
                                <a href="#" class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Lessons</a>
                            </li>
                            <li>
                                <a href="#" class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700">Chatbot</a>
                            </li>
                        </ul>                        
                    </div>
                </div>
            </nav>
        
            <main>
                {% block main %}
                <!-- This space will be filled in by child templates -->
                {% endblock %}
            </main>

            <footer class="bg-white shadow sm:flex sm:items-center sm:justify-between p-4 sm:p-4 xl:p-6 dark:bg-gray-800 antialiased mt-auto">
                <p class="mb-4 text-sm text-center text-gray-500 dark:text-gray-400 sm:mb-0">
                    &copy; 2024 <a href="/" class="hover:underline" target="_blank">B-Grade English</a> All rights reserved.
                </p>
                <!-- Facebook Icon -->
                <div class="flex justify-center items-center space-x-1">
                    <a href="https://www.facebook.com/p/D-Style-%E8%8B%B1%E8%AA%9E%E5%AD%A6%E5%9C%92-100088277141105/" data-tooltip-target="tooltip-facebook" class="inline-flex justify-center p-2 text-gray-500 rounded-lg cursor-pointer dark:text-gray-400 dark:hover:text-white hover:text-gray-900 hover:bg-gray-100 dark:hover:bg-gray-600">
                        <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 8 19">
                            <path fill-rule="evenodd" d="M6.135 3H8V0H6.135a4.147 4.147 0 0 0-4.142 4.142V6H0v3h2v9.938h3V9h2.021l.592-3H5V3.591A.6.6 0 0 1 5.592 3h.543Z" clip-rule="evenodd"/>
                        </svg>
                        <span class="sr-only">Facebook</span>
                    </a>
                    <div id="tooltip-facebook" role="tooltip" class="inline-block absolute invisible z-10 py-2 px-3 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 transition-opacity duration-300 tooltip dark:bg-gray-700">
                        Like us on Facebook
                        <div class="tooltip-arrow" data-popper-arrow></div>
                    </div>

                    <a href="https://www.instagram.com/dstyle.english/" data-tooltip-target="tooltip-instagram" class="inline-flex justify-center p-2 text-gray-500 rounded-lg cursor-pointer dark:text-gray-400 dark:hover:text-white hover:text-gray-900 hover:bg-gray-100 dark:hover:bg-gray-600">
                        <span class="h-5 w-5">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 448 512">
                                <path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z" />
                            </svg>
                        </span>
                        <span class="sr-only">Instagram</span>
                    </a>
                    <div id="tooltip-instagram" role="tooltip" class="inline-block absolute invisible z-10 py-2 px-3 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 transition-opacity duration-300 tooltip dark:bg-gray-700">
                        Follow us on Instagram
                        <div class="tooltip-arrow" data-popper-arrow></div>
                    </div>

                    <a href="https://www.tiktok.com/@dstyle.english" data-tooltip-target="tooltip-tiktok" class="inline-flex justify-center p-2 text-gray-500 rounded-lg cursor-pointer dark:text-gray-400 dark:hover:text-white hover:text-gray-900 hover:bg-gray-100 dark:hover:bg-gray-600">
                        <span class="h-5 w-5">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 448 512">
                                <path d="M448 209.9a210.1 210.1 0 0 1 -122.8-39.3V349.4A162.6 162.6 0 1 1 185 188.3V278.2a74.6 74.6 0 1 0 52.2 71.2V0l88 0a121.2 121.2 0 0 0 1.9 22.2h0A122.2 122.2 0 0 0 381 102.4a121.4 121.4 0 0 0 67 20.1z" />
                            </svg>
                        </span>
                        <span class="sr-only">TikTok</span>
                    </a>
                    <div id="tooltip-tiktok" role="tooltip" class="inline-block absolute invisible z-10 py-2 px-3 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 transition-opacity duration-300 tooltip dark:bg-gray-700">
                        Follow us on TikTok
                        <div class="tooltip-arrow" data-popper-arrow></div>
                    </div>
                </div>
            </footer>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const themeToggleBtn = document.getElementById('theme-toggle');
                const darkIcon = document.getElementById('theme-toggle-dark-icon');
                const lightIcon = document.getElementById('theme-toggle-light-icon');
                const themeToggleText = document.getElementById('theme-toggle-text');
                const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const currentTheme = localStorage.getItem('theme');
        
                function updateThemeIcons(isDarkMode) {
                    if (isDarkMode) {
                        darkIcon.classList.remove('hidden');
                        lightIcon.classList.add('hidden');
                        themeToggleText.textContent = 'Light Mode';
                    } else {
                        darkIcon.classList.add('hidden');
                        lightIcon.classList.remove('hidden');
                        themeToggleText.textContent = 'Dark Mode';
                    }
                }
        
                if (currentTheme !== 'light' && (currentTheme === 'dark' || prefersDarkScheme)) {
                    document.documentElement.classList.add('dark');
                    updateThemeIcons(true);
                } else {
                    updateThemeIcons(false);
                }
        
                themeToggleBtn.addEventListener('click', function () {
                    document.documentElement.classList.toggle('dark');
                    const isDarkMode = document.documentElement.classList.contains('dark');
                    localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                    updateThemeIcons(isDarkMode);
                });
            });

            document.getElementById('navbar-toggle').addEventListener('click', function () {
                document.getElementById('navbar-links').classList.toggle('hidden');
            });

            document.addEventListener('DOMContentLoaded', function() {
                var calendarEl = document.getElementById('calendar');
            
                var calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'timeGridWeek',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'timeGridWeek,timeGridDay'
                    },
                    events: [
                        {% for slot in lesson_slots %}
                        {
                            id: '{{ slot.id }}',
                            title: '{{ "BOOKED" if slot.is_booked else "OPEN" }}',
                            start: '{{ slot.start_time.isoformat() }}',
                            end: '{{ slot.end_time.isoformat() }}',
                            color: '{{ "blue" if slot.is_booked else "orange" }}'
                        },
                        {% endfor %}
                    ],
                    editable: true,
                    selectable: true,
                    selectMirror: true,
                    select: function(arg) {
                        var title = prompt('Event Title:');
                        if (title) {
                            calendar.addEvent({
                                title: title,
                                start: arg.start,
                                end: arg.end,
                                allDay: arg.allDay
                            });
                        }
                        calendar.unselect();
                    },
                    eventClick: function(arg) {
                        if (confirm('Are you sure you want to delete this event?')) {
                            arg.event.remove();
                        }
                    },
                    eventDrop: function(info) {
                        // Handle event drop (update start and end time)
                    },
                    eventResize: function(info) {
                        // Handle event resize (update end time)
                    }
                });
            
                calendar.render();
            });
            
        </script>          
    </body>
</html>
