{% extends "layout.html" %}

{% block title %}
    Edit Lesson
{% endblock %}

{% block main %}
<section class="bg-white dark:bg-gray-900">
    <div class="max-w-screen-xl px-4 py-8 mx-auto lg:py-16">
        <h1 class="text-3xl font-extrabold leading-none tracking-tight md:text-5xl xl:text-6xl dark:text-white mb-8">
            Edit Lesson for {{ lesson.student.username }}
        </h1>
        <form method="POST" id="edit-lesson-form">
            {{ form.hidden_tag() }}
            <div class="mb-4">
                {{ form.lesson_summary.label(class="block text-sm font-medium text-gray-700 dark:text-gray-300") }}
                {{ form.lesson_summary(class="mt-1 block w-full shadow-sm sm:text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:text-gray-100") }}
            </div>
            <div class="mb-4">
                {{ form.strengths.label(class="block text-sm font-medium text-gray-700 dark:text-gray-300") }}
                {{ form.strengths(class="mt-1 block w-full shadow-sm sm:text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:text-gray-100") }}
            </div>
            <div class="mb-4">
                {{ form.areas_to_improve.label(class="block text-sm font-medium text-gray-700 dark:text-gray-300") }}
                {{ form.areas_to_improve(class="mt-1 block w-full shadow-sm sm:text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:text-gray-100") }}
            </div>
            <div class="mb-4">
                <label for="new_word" class="block text-sm font-medium text-gray-700 dark:text-gray-300">New Words</label>
                <input type="text" id="new_word" class="mt-1 block w-full shadow-sm sm:text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:text-gray-100" placeholder="Type a new word and hit Enter">
                <div id="new_words_list" class="mt-2">
                    {% for word in lesson.new_words %}
                    <span class="inline-block bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-medium mr-2 mb-2 px-3 py-1 rounded">{{ word }}</span>
                    {% endfor %}
                </div>
            </div>
            <div class="mb-4">
                <label for="new_phrase" class="block text-sm font-medium text-gray-700 dark:text-gray-300">New Phrases</label>
                <input type="text" id="new_phrase" class="mt-1 block w-full shadow-sm sm:text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:text-gray-100" placeholder="Type a new phrase and hit Enter">
                <div id="new_phrases_list" class="mt-2">
                    {% for phrase in lesson.new_phrases %}
                    <span class="inline-block bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-medium mr-2 mb-2 px-3 py-1 rounded">{{ phrase }}</span>
                    {% endfor %}
                </div>
            </div>
            {{ form.new_words(class="hidden") }}
            {{ form.new_phrases(class="hidden") }}
            <div>
                {{ form.submit(class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-500") }}
            </div>
        </form>
    </div>
</section>
{% endblock %}
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const newWordInput = document.getElementById('new_word');
        const newWordsList = document.getElementById('new_words_list');
        const hiddenNewWords = document.getElementById('{{ form.new_words.id }}');
        const newWords = {{ lesson.new_words | tojson }};
    
        const newPhraseInput = document.getElementById('new_phrase');
        const newPhrasesList = document.getElementById('new_phrases_list');
        const hiddenNewPhrases = document.getElementById('{{ form.new_phrases.id }}');
        const newPhrases = {{ lesson.new_phrases | tojson }};
    
        function updateHiddenFields() {
            hiddenNewWords.value = JSON.stringify(newWords);
            hiddenNewPhrases.value = JSON.stringify(newPhrases);
        }
    
        function addTag(tag, list, array) {
            array.push(tag);
            const span = document.createElement('span');
            span.textContent = tag;
            span.classList.add('inline-block', 'bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200', 'text-sm', 'font-medium', 'mr-2', 'mb-2', 'px-3', 'py-1', 'rounded');
            list.appendChild(span);
            updateHiddenFields();
        }
    
        newWordInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                if (newWordInput.value.trim() !== '') {
                    addTag(newWordInput.value.trim(), newWordsList, newWords);
                    newWordInput.value = '';
                }
            }
        });
        
        newPhraseInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                if (newPhraseInput.value.trim() !== '') {
                    addTag(newPhraseInput.value.trim(), newPhrasesList, newPhrases);
                    newPhraseInput.value = '';
                }
            }
        });
    
        document.getElementById('edit-lesson-form').addEventListener('keydown', (event) => {
            if ((event.target === newWordInput || event.target === newPhraseInput) && event.key === 'Enter') {
                event.preventDefault();
            }
        });

        document.getElementById('edit-lesson-form').addEventListener('submit', (event) => {
            if (newWordInput.value.trim() !== '' || newPhraseInput.value.trim() !== '') {
                event.preventDefault();
                alert('Please press Enter after adding new words or phrases.');
            } else {
                updateHiddenFields();
            }
        });
    
        updateHiddenFields();
    });
</script>
