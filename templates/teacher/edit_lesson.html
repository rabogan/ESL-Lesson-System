{% extends "layout.html" %}

{% block title %}
    Edit Lesson
{% endblock %}

{% block main %}
<section class="bg-white dark:bg-gray-900">
    <div class="max-w-screen-xl px-4 py-8 mx-auto lg:py-16">
        <h1 class="text-3xl font-extrabold leading-none tracking-tight md:text-5xl xl:text-6xl dark:text-white mb-8">
            Edit Lesson for {{ lesson.student.username }}
        </h1>
        <form method="POST" id="edit-lesson-form">
            <div class="mb-4">
                <label for="lesson_summary" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Lesson Summary</label>
                <textarea id="lesson_summary" name="lesson_summary" rows="4" class="mt-1 block w-full shadow-sm sm:text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:text-gray-100">{{ lesson.lesson_summary }}</textarea>
            </div>
            <div class="mb-4">
                <label for="strengths" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Strengths</label>
                <textarea id="strengths" name="strengths" rows="2" class="mt-1 block w-full shadow-sm sm:text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:text-gray-100">{{ lesson.strengths }}</textarea>
            </div>
            <div class="mb-4">
                <label for="areas_to_improve" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Areas to Improve</label>
                <textarea id="areas_to_improve" name="areas_to_improve" rows="2" class="mt-1 block w-full shadow-sm sm:text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:text-gray-100">{{ lesson.areas_to_improve }}</textarea>
            </div>
            <div class="mb-4">
                <label for="new_word" class="block text-sm font-medium text-gray-700 dark:text-gray-300">New Words</label>
                <input type="text" id="new_word" class="mt-1 block w-full shadow-sm sm:text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:text-gray-100" placeholder="Type a new word and hit Enter">
                <div id="new_words_list" class="mt-2">
                    {% for word in lesson.new_words %}
                    <span class="inline-block bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-medium mr-2 mb-2 px-3 py-1 rounded">{{ word }}</span>
                    {% endfor %}
                </div>
            </div>
            <div class="mb-4">
                <label for="new_phrase" class="block text-sm font-medium text-gray-700 dark:text-gray-300">New Phrases</label>
                <input type="text" id="new_phrase" class="mt-1 block w-full shadow-sm sm:text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:text-gray-100" placeholder="Type a new phrase and hit Enter">
                <div id="new_phrases_list" class="mt-2">
                    {% for phrase in lesson.new_phrases %}
                    <span class="inline-block bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 text-sm font-medium mr-2 mb-2 px-3 py-1 rounded">{{ phrase }}</span>
                    {% endfor %}
                </div>
            </div>
            <input type="hidden" name="new_words" id="hidden_new_words">
            <input type="hidden" name="new_phrases" id="hidden_new_phrases">
            <div>
                <button type="submit" class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-500">Update Lesson</button>
            </div>
        </form>
    </div>
</section>
{% endblock %}
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const newWordInput = document.getElementById('new_word');
        const newWordsList = document.getElementById('new_words_list');
        const hiddenNewWords = document.getElementById('hidden_new_words');
        const newWords = {{ lesson.new_words | tojson }};
    
        const newPhraseInput = document.getElementById('new_phrase');
        const newPhrasesList = document.getElementById('new_phrases_list');
        const hiddenNewPhrases = document.getElementById('hidden_new_phrases');
        const newPhrases = {{ lesson.new_phrases | tojson }};
    
        function updateHiddenFields() {
            hiddenNewWords.value = JSON.stringify(newWords);
            hiddenNewPhrases.value = JSON.stringify(newPhrases);
        }
    
        function addTag(tag, list, array) {
            array.push(tag);
            const span = document.createElement('span');
            span.textContent = tag;
            span.classList.add('inline-block', 'bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200', 'text-sm', 'font-medium', 'mr-2', 'mb-2', 'px-3', 'py-1', 'rounded');
            list.appendChild(span);
            updateHiddenFields();
        }
    
        newWordInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                if (newWordInput.value.trim() !== '') {
                    addTag(newWordInput.value.trim(), newWordsList, newWords);
                    newWordInput.value = '';
                }
            }
        });
        
        newPhraseInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                if (newPhraseInput.value.trim() !== '') {
                    addTag(newPhraseInput.value.trim(), newPhrasesList, newPhrases);
                    newPhraseInput.value = '';
                }
            }
        });
    
        // Prevent form submission when Enter is pressed in newWordInput or newPhraseInput
        document.getElementById('edit-lesson-form').addEventListener('keydown', (event) => {
            if ((event.target === newWordInput || event.target === newPhraseInput) && event.key === 'Enter') {
                event.preventDefault();
            }
        });

        // Prevent form submission when hitting Enter key in any input
        document.getElementById('edit-lesson-form').addEventListener('submit', (event) => {
            if (newWordInput.value.trim() !== '' || newPhraseInput.value.trim() !== '') {
                event.preventDefault();
            } else {
                updateHiddenFields();
            }
        });
    
        updateHiddenFields();
    });
</script>
